!function(){var e,t,n,r,o={389:function(e,t,n){"use strict";t.TC=t.Vy=void 0;const r=n(0);Object.defineProperty(t,"Vy",{enumerable:!0,get:function(){return r.EventNames}});const o=n(138);Object.defineProperty(t,"TC",{enumerable:!0,get:function(){return o.ImpressionValidator}})},0:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventNames=void 0,(t.EventNames||(t.EventNames={})).VALIDATED_IMPRESSION="validated_impression"},138:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImpressionValidator=void 0;const r=n(0);t.ImpressionValidator=class{constructor(e,t){if(this.processedElements=[],!e)return;const n=this.convertToHTMLElementList(e.querySelectorAll("."+t));0!==n.length&&(this.elements=n,this.processedElements=[],this.processElements(),window.addEventListener("scroll",(()=>{this.processElements()}),{passive:!0}),window.addEventListener("resize",(()=>{this.processElements()})),e.addEventListener("scroll",(()=>{this.processElements()}),{passive:!0}))}processElements(){if(!this.elements)throw new Error("ImpressionValidator: Elements not set!");const e=[];this.elements.forEach((t=>{this.isVisible(t)?(t.dispatchEvent(new CustomEvent(r.EventNames.VALIDATED_IMPRESSION)),this.processedElements.push(t)):e.push(t)})),this.elements=e}updateElements(e,t){if(!e)throw new Error("ImpressionValidator: no parent container provided!");const n=this.convertToHTMLElementList(e.querySelectorAll("."+t)),r=[];n.forEach((e=>{this.processedElements.find((t=>t===e))||r.push(e)})),this.elements=r,this.processElements()}convertToHTMLElementList(e){const t=[];for(const n of e)t.push(n);return t}isVisible(e){if(!e)return!1;const t=e.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight,r=window.innerWidth||document.documentElement.clientWidth;return!this.elementHasNoDimensions(t)&&this.isElementInViewVertical(t,n)&&this.isElementInViewHorizontal(t,r)}elementHasNoDimensions(e){return e.width<=0||e.height<=0}isElementInViewVertical(e,t){return e.top<=t-.33*e.height&&e.top+.66*e.height>=0}isElementInViewHorizontal(e,t){return e.left<=t-.33*e.width&&e.left+.66*e.width>=0}}},71:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(549),o=(0,r.reactive)({studies:[],studyIds:[],initialized:!1,error:!1}),i={studies:()=>o.studies,studyIds:()=>o.studyIds,initialized:()=>o.initialized,error:()=>o.error,canShowComparison:()=>o.studyIds.length>1},s={setStudies:e=>{o.studies=e},setInitializedFlag:()=>{o.initialized=!0},unsetInitializedFlag:()=>{o.initialized=!1},setErrorFlag:()=>{o.error=!0},removeStudy:e=>{o.studies=o.studies.filter((t=>t.id!==e))},addStudyId:e=>{o.studyIds.push(e)},removeStudyId:e=>{o.studyIds=o.studyIds.filter((t=>t!==e))}};class a{constructor(){try{this.apiURL="https://comparison-api.prtl.co/"}catch(e){this.apiURL=""}}get(e){return t=this,r=function*(){const t=this.apiURL+"studies?ids="+e.join(",");let n;try{n=yield fetch(t),n=yield n.json()}catch(e){n={studies:[]}}const{studies:r}=n;return r},new((n=void 0)||(n=Promise))((function(e,o){function i(e){try{a(r.next(e))}catch(e){o(e)}}function s(e){try{a(r.throw(e))}catch(e){o(e)}}function a(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n((function(e){e(r)}))).then(i,s)}a((r=r.apply(t,[])).next())}));var t,n,r}}var c={initializeData:e=>{return n=function*(){let t=e;t&&t.length||(t=d.getters.studyIds());const n=yield(new a).get(t);0===n.length&&s.setErrorFlag(),s.setStudies(n),s.setInitializedFlag()},new((t=void 0)||(t=Promise))((function(e,r){function o(e){try{s(n.next(e))}catch(e){r(e)}}function i(e){try{s(n.throw(e))}catch(e){r(e)}}function s(n){var r;n.done?e(n.value):(r=n.value,r instanceof t?r:new t((function(e){e(r)}))).then(o,i)}s((n=n.apply(void 0,[])).next())}));var t,n},remove:e=>{s.removeStudyId(e),s.removeStudy(e)},addStudyId:e=>{s.addStudyId(e)}},d={state:(0,r.readonly)(o),getters:i,mutations:s,actions:c}},576:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r,o={Comparison:"Comparison"},i={ToggleDataGroup:"toggle_data_group",ComparisonStart:"comparison_start",StudyRemove:"study_remove",StudyClick:"study_click",TimeSpent:"comparison_overview - timespent"},s=n(534),a={eventBus:{all:r=r||new Map,on:function(e,t){var n=r.get(e);n?n.push(t):r.set(e,[t])},off:function(e,t){var n=r.get(e);n&&(t?n.splice(n.indexOf(t)>>>0,1):r.set(e,[]))},emit:function(e,t){var n=r.get(e);n&&n.slice().map((function(e){e(t)})),(n=r.get("*"))&&n.slice().map((function(n){n(e,t)}))}},tracking:new class{constructor(){this.actions=i,this.categories=o}GA(e){return void 0===window.Shared||void 0===window.Shared.GA?null:void window.Shared.GA.fireTracker({category:e.category,action:e.action,label:e.label,value:e.value})}snowPlow(e){if(void 0===window.snowplow)return null;window.snowplow("trackStructEvent",{category:e.category,action:e.action,label:e.label||"",property:e.property||"",value:e.value||0})}},datalakeTracker:new class{constructor(){this.tracker=new s.Tracker(s.Product.COMPARISON_TOOL)}trackImpression(e){const t={action:s.Action.IMPRESSION,label:"widget@search_card",property:String(e)};try{this.tracker.trackStructuredEvent(t)}catch(e){}}trackClick(e){const t={action:s.Action.CLICK,label:"widget@search_card",property:String(e)};try{this.tracker.trackStructuredEvent(t)}catch(e){}}}}},744:function(e,t){"use strict";t.Z=(e,t)=>{const n=e.__vccOpts||e;for(const[e,r]of t)n[e]=r;return n}},534:function(e,t,n){e.exports=n(505)("./node_modules/@studyportals/datalake-event-tracker/dist/datalake_event_tracker.js")},295:function(e,t,n){e.exports=n(141)("./node_modules/@studyportals/vue-platform/dist/vue_platform.js")},549:function(e,t,n){e.exports=n(717)("v")},505:function(e){"use strict";e.exports=datalake_event_tracker_v4},717:function(e){"use strict";e.exports=vue3_library_v5},141:function(e){"use strict";e.exports=vue_platform_v1}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return o[e].call(n.exports,n,n.exports,s),n.exports}s.m=o,s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,{a:t}),t},s.d=function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.f={},s.e=function(e){return Promise.all(Object.keys(s.f).reduce((function(t,n){return s.f[n](e,t),t}),[]))},s.u=function(e){return e+"."+s.h()+".js"},s.miniCssF=function(e){return e+"."+s.h()+".css"},s.h=function(){return"fff078f14548ba740774"},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e={},t="comparison_tool:",s.l=function(n,r,o,i){if(e[n])e[n].push(r);else{var a,c;if(void 0!==o)for(var d=document.getElementsByTagName("script"),l=0;l<d.length;l++){var u=d[l];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+o){a=u;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.setAttribute("data-webpack",t+o),a.src=n),e[n]=[r];var p=function(t,r){a.onerror=a.onload=null,clearTimeout(m);var o=e[n];if(delete e[n],a.parentNode&&a.parentNode.removeChild(a),o&&o.forEach((function(e){return e(r)})),t)return t(r)},m=setTimeout(p.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=p.bind(null,a.onerror),a.onload=p.bind(null,a.onload),c&&document.head.appendChild(a)}},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="https://comparisontool.prtl.co/dist/",n=function(e){return new Promise((function(t,n){var r=s.miniCssF(e),o=s.p+r;if(function(e,t){for(var n=document.getElementsByTagName("link"),r=0;r<n.length;r++){var o=(s=n[r]).getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(o===e||o===t))return s}var i=document.getElementsByTagName("style");for(r=0;r<i.length;r++){var s;if((o=(s=i[r]).getAttribute("data-href"))===e||o===t)return s}}(r,o))return t();!function(e,t,n,r){var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.onerror=o.onload=function(i){if(o.onerror=o.onload=null,"load"===i.type)n();else{var s=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.href||t,c=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");c.code="CSS_CHUNK_LOAD_FAILED",c.type=s,c.request=a,o.parentNode.removeChild(o),r(c)}},o.href=t,document.head.appendChild(o)}(e,o,t,n)}))},r={296:0},s.f.miniCss=function(e,t){r[e]?t.push(r[e]):0!==r[e]&&{228:1}[e]&&t.push(r[e]=n(e).then((function(){r[e]=0}),(function(t){throw delete r[e],t})))},function(){var e={296:0};s.f.j=function(t,n){var r=s.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise((function(n,o){r=e[t]=[n,o]}));n.push(r[2]=o);var i=s.p+s.u(t),a=new Error;s.l(i,(function(n){if(s.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+i+")",a.name="ChunkLoadError",a.type=o,a.request=i,r[1](a)}}),"chunk-"+t,t)}};var t=function(t,n){var r,o,i=n[0],a=n[1],c=n[2],d=0;if(i.some((function(t){return 0!==e[t]}))){for(r in a)s.o(a,r)&&(s.m[r]=a[r]);c&&c(s)}for(t&&t(n);d<i.length;d++)o=i[d],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0},n=self.webpackChunkcomparison_tool=self.webpackChunkcomparison_tool||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var a={};!function(){"use strict";s.d(a,{Z:function(){return E}});var e=s(549);const t={class:"WidgetContainer",ref:"WidgetContainer"},n={class:"WidgetCheckbox js-Compare-Widget"},r=["checked"];var o,i=s(295),c=s(71),d=s(576),l=s(389);class u{constructor(e,t){this.parentElement=e,this.studyId=t,this.parentElement&&(this.bindImpressionEvent(),this.impressionValidator=new l.TC(this.parentElement,"js-Compare-Widget"),this.impressionValidator.processElements())}processElement(){var e;null===(e=this.impressionValidator)||void 0===e||e.processElements()}bindImpressionEvent(){var e;const t=null===(e=this.parentElement)||void 0===e?void 0:e.querySelector(".js-Compare-Widget");null==t||t.addEventListener(l.Vy.VALIDATED_IMPRESSION,(()=>{d.Z.datalakeTracker.trackImpression(this.studyId)}))}}class p{}!function(e){e.COMPARISON_TOOL_READY_EVENT="COMPARISON_TOOL_READY_EVENT"}(o||(o={}));class m{constructor(e){this.comparisonToolApplication=e,this.eventType=m.EventType,this.timestamp=new Date}}m.EventType=o.COMPARISON_TOOL_READY_EVENT;class h{constructor(t){this.studyId=t,this.WidgetContainer=(0,e.ref)(null),this.canShowComparison=(0,e.computed)((()=>c.Z.getters.canShowComparison())),this.isSelected=(0,e.computed)((()=>c.Z.getters.studyIds().some((e=>e===this.studyId)))),this.widgetLabel=(0,e.computed)((()=>this.canShowComparison.value&&this.isSelected.value?"Compare now":this.isSelected.value?"Added to compare":"Add to compare"))}mounted(){var e;this.impressionTracker=new u(this.WidgetContainer.value,this.studyId),null===(e=this.impressionTracker)||void 0===e||e.processElement()}toggleStudySelected(e){e.preventDefault(),e.stopPropagation(),this.isSelected.value?c.Z.actions.remove(this.studyId):(c.Z.actions.addStudyId(this.studyId),d.Z.datalakeTracker.trackClick(this.studyId))}labelClicked(e){e.preventDefault(),e.stopPropagation(),this.isSelected.value&&this.canShowComparison.value?E.openInternalComparison(new p):this.toggleStudySelected(e)}}var f=(0,e.defineComponent)({props:{studyId:Number,widgetLocation:String},setup:e=>{const t=new h(e.studyId);return(0,i.setupComponent)(t)}}),v=(0,s(744).Z)(f,[["render",function(o,i,s,a,c,d){return(0,e.openBlock)(),(0,e.createElementBlock)("div",t,[(0,e.createElementVNode)("label",n,[(0,e.createElementVNode)("div",{onClick:i[0]||(i[0]=e=>o.labelClicked(e)),class:(0,e.normalizeClass)([o.canShowComparison&&o.isSelected?"WidgetGreen":"","WidgetLabel"])},(0,e.toDisplayString)(o.widgetLabel),3),(0,e.createElementVNode)("input",{type:"checkbox",checked:o.isSelected,ref:"checkbox"},null,8,r),(0,e.createElementVNode)("span",{class:(0,e.normalizeClass)(["Checkmark",{Selected:o.isSelected}]),onClick:i[1]||(i[1]=e=>o.toggleStudySelected(e))},null,2)])],512)}],["__scopeId","data-v-e9f17b7a"]]);const g=new class{openInternalComparison(e){if(!c.Z.getters.canShowComparison())throw new Error("No studies to compare");document.dispatchEvent(new CustomEvent("load_comparison_drawer_independent")),this.openComparison(c.Z.getters.studyIds())}openExternalComparison(e){if(!Array.isArray(e.ids)||0===e.ids.length)throw new Error("Invalid ids provided");document.dispatchEvent(new CustomEvent("load_comparison_drawer")),this.openComparison(e.ids)}renderWidgets(t){const n=document.querySelectorAll(".ComparisonWidget");n.length<1||n.forEach((t=>{const n=parseInt(t.getAttribute("data-study-id"),10),r=t.getAttribute("data-widget-location");n&&(0,e.createApp)({render:()=>(0,e.h)(v,{studyId:n,widgetLocation:r})}).mount(t)}))}openComparison(t){const n=(0,e.defineAsyncComponent)((()=>s.e(228).then(s.bind(s,228))));(0,e.createApp)({render:()=>(0,e.h)(n,{studyIds:t})}).mount("#ComparisonToolPlaceholder")}},y=new m(g);window.EventAggregationService.publishTo(y.eventType,y);var E=g}()}();
//# sourceMappingURL=bundle.fff078f14548ba740774.js.map