(()=>{"use strict";var e={243:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DataStorage=void 0;var n=function(){function e(){this.enabled=!1}return e.prototype.init=function(){try{if("undefined"==typeof localStorage)return void(this.enabled=!1);localStorage.setItem("test","dummy value"),localStorage.removeItem("test"),this.enabled=!0}catch(e){this.enabled=!1}},e.prototype.store=function(e,t,n){if(void 0===n&&(n=1800),this.enabled){var i=new Date,o={expires:i.setSeconds(i.getSeconds()+n),data:t};localStorage[e]=JSON.stringify(o)}else document.cookie=e+"="+t+";expires="+n/86400;return!0},e.prototype.retrieve=function(e){if(this.enabled){var t=localStorage[e];try{t=JSON.parse(t)}catch(e){t={}}if(!t||!t.hasOwnProperty("expires")||!t.hasOwnProperty("data"))return"";var n=parseInt(t.expires,10);return isNaN(n)&&(n=0),new Date>=new Date(n)?(localStorage[e]=null,""):t.data}return this.getCookie(e)},e.prototype.remove=function(e){this.enabled?delete localStorage[e]:document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"},e.prototype.update=function(e,t,n){var i=this.retrieve(e);return"object"!=typeof i&&(i={}),i=Object.assign({},i,t),this.store(e,i,n),i},e.prototype.getCookie=function(e){var t=RegExp(e+"=.[^;]*"),n=document.cookie.match(t);return n?n[0].split("=")[1]:""},e}();t.DataStorage=n},36:(e,t,n)=>{var i=new(n(243).DataStorage);i.init(),e.exports={DataStorage:i}},725:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventAggregationEventType=void 0,(t.EventAggregationEventType||(t.EventAggregationEventType={})).WEBSOCKET_SERVICE_READY="WebsocketServiceReady"},423:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},759:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},570:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WebsocketServiceReadyEvent=void 0;const i=n(725);class o{constructor(e){this.eventAggregationService=e,this.eventType=o.EventType,this.timestamp=new Date}}t.WebsocketServiceReadyEvent=o,o.EventType=i.EventAggregationEventType.WEBSOCKET_SERVICE_READY},385:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(400),t),o(n(423),t),o(n(759),t),o(n(570),t),o(n(725),t)},400:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},328:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(385),t),o(n(285),t),o(n(519),t)},974:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},112:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.SessionServiceEventType=void 0,(n=t.SessionServiceEventType||(t.SessionServiceEventType={})).SESSION_SERVICE_READY="SessionServiceReady",n.SESSION_CREATED="SessionCreated",n.SESSION_DESTROYED="SessionDestroyed"},641:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SessionCreatedEvent=void 0;const i=n(112);class o{constructor(e){this.eventType=o.EventType,this.timestamp=new Date,this.session=e}}t.SessionCreatedEvent=o,o.EventType=i.SessionServiceEventType.SESSION_CREATED},533:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SessionDestroyedEvent=void 0;const i=n(112);class o{constructor(){this.eventType=o.EventType,this.timestamp=new Date}}t.SessionDestroyedEvent=o,o.EventType=i.SessionServiceEventType.SESSION_DESTROYED},927:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SessionServiceReadyEvent=void 0;const i=n(112);class o{constructor(e){this.eventType=o.EventType,this.timestamp=new Date,this.sessionService=e}}t.SessionServiceReadyEvent=o,o.EventType=i.SessionServiceEventType.SESSION_SERVICE_READY},285:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(24),t),o(n(615),t),o(n(256),t),o(n(497),t),o(n(974),t),o(n(386),t),o(n(927),t),o(n(533),t),o(n(641),t),o(n(112),t)},24:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},386:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},256:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},615:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},497:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},301:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},258:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WishlistServiceEventType=void 0,(t.WishlistServiceEventType||(t.WishlistServiceEventType={})).WISHLIST_SERVICE_READY="WishlistServiceReady"},549:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WishlistServiceReadyEvent=void 0;const i=n(258);class o{constructor(e){this.wishlistService=e,this.eventType=o.EventType,this.timestamp=new Date}}t.WishlistServiceReadyEvent=o,o.EventType=i.WishlistServiceEventType.WISHLIST_SERVICE_READY},519:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(301),t),o(n(549),t)},527:(e,t,n)=>{t.Gq=void 0;const i=n(411);Object.defineProperty(t,"Gq",{enumerable:!0,get:function(){return i.StudentField}}),n(322)},322:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.AttendanceType=void 0,(n=t.AttendanceType||(t.AttendanceType={})).ONLINE="online",n.ON_CAMPUS="oncampus",n.BLENDED="blended"},411:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.StudentField=void 0,(n=t.StudentField||(t.StudentField={})).IDENTITY_ID="identityId",n.EMAIL="email",n.NAME="name",n.FIRST_NAME="first_name",n.LAST_NAME="last_name",n.GENDER="gender",n.BIRTH_DATE="birth_date",n.TELEPHONE="telephone",n.START_PERIOD_DATE="start_period_date",n.FUNDING_TYPE="funding_type",n.STUDY_LEVEL="study_level",n.PREFERRED_STUDY_LEVEL="preferred_study_level",n.RESIDENCE_COUNTRY_ID="residence_country_id",n.NATIONALITY_COUNTRY_ID="nationality_country_id",n.NATIONALITY_COUNTRY_ISO="nationality_country_iso",n.STUDY_COUNTRY_ID="study_country_id",n.REGISTRATION_IP="registration_ip",n.REGISTRATION_PORTAL_TYPE="registration_portal_type",n.WORK_EXPERIENCE="work_experience",n.PROFICIENCY_TYPE="proficiency_type",n.PROFICIENCY_TEST="proficiency_test",n.PROFICIENCY_SCORE="proficiency_score",n.IELTS="ielts",n.CAE="cae",n.FCE="fce",n.TOEFL_IBT="toefl_ibt",n.TOEFL_PBT="toefl_pbt",n.PTE="pte",n.SELF_ASSESSMENT_PROFICIENCY="self_assessment_proficiency",n.INITIAL_REGISTRATION_PLATFORM="initial_registration_platform",n.REFERRER="referrer",n.EMAILING_OTHER="emailing_other",n.EMAILING_FAVOURITES="emailing_favourites",n.EMAILING_SCHOLARSHIPS="emailing_scholarships",n.EMAILING_UPDATES="emailing_updates",n.LAST_LOGIN_UTC="last_login_utc",n.DATE_CREATED_UTC="date_created_utc",n.DATE_MODIFIED_UTC="date_modified_utc",n.LOGINS="logins",n.DISCIPLINES="disciplines",n.INTERESTS_COUNTRIES="interests_countries",n.INTERESTS_DISCIPLINES="interests_disciplines",n.EMAIL_UNSUBSCRIBE_TOKEN="emailUnsubscribeToken",n.GDPR_ACCEPTED="gdpr_accepted",n.ORIGIN_ORGANISATION_ID="origin_organisation_id",n.FLAGS="flags",n.GPA="gpa",n.LIVING_BUDGET="living_budget",n.TUITION_BUDGET="tuition_budget",n.SEEN_COMPARISON_TUTORIAL="seen_comparison_tutorial",n.ACCOMPLISHMENTS="accomplishments",n.CURRENCY="currency",n.AFFILIATE="affiliate",n.AFFILIATE_URL="affiliate_url",n.ATTENDANCE="attendance",n.TRAFFIC_SOURCE="traffic_source",n.TRAFFIC_SOURCE_URL="traffic_source_url",n.DISMISSED_ONBOARDING_QUESTIONNAIRE="dismissed_onboarding_questionnaire",n.STARTED_ONBOARDING_QUESTIONNAIRE="started_onboarding_questionnaire",n.UNIBUDDY_CHATS="unibuddy_chats",n.UNIBUDDY_YEAR_OF_ENTRY="unibuddy_year_of_entry"},996:e=>{var t=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===n}(e)}(e)},n="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function i(e,t){return!1!==t.clone&&t.isMergeableObject(e)?a((n=e,Array.isArray(n)?[]:{}),e,t):e;var n}function o(e,t,n){return e.concat(t).map((function(e){return i(e,n)}))}function r(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return Object.propertyIsEnumerable.call(e,t)})):[]}(e))}function s(e,t){try{return t in e}catch(e){return!1}}function a(e,n,c){(c=c||{}).arrayMerge=c.arrayMerge||o,c.isMergeableObject=c.isMergeableObject||t,c.cloneUnlessOtherwiseSpecified=i;var u=Array.isArray(n);return u===Array.isArray(e)?u?c.arrayMerge(e,n,c):function(e,t,n){var o={};return n.isMergeableObject(e)&&r(e).forEach((function(t){o[t]=i(e[t],n)})),r(t).forEach((function(r){(function(e,t){return s(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,r)||(s(e,r)&&n.isMergeableObject(t[r])?o[r]=function(e,t){if(!t.customMerge)return a;var n=t.customMerge(e);return"function"==typeof n?n:a}(r,n)(e[r],t[r],n):o[r]=i(t[r],n))})),o}(e,n,c):i(n,c)}a.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,n){return a(e,n,t)}),{})};var c=a;e.exports=c}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={exports:{}};return e[i].call(r.exports,r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e,t,i,o;!function(e){e.AnonymousStudentServiceReady="anonymous-student-service-ready",e.AnonymousStudentProfileUpdated="anonymous-student-profile-updated",e.AnonymousStudentProfileSynced="anonymous-student-profile-synced",e.AnonymousStudentStateChanged="anonymous-student-state-changed"}(e||(e={}));class r{constructor(e,t){this.timestamp=e,this.state=t,this.eventType=r.EventType}}r.EventType=e.AnonymousStudentProfileSynced,function(e){e.COUNTRY="interests_countries",e.DISCIPLINE="interests_disciplines"}(t||(t={})),function(e){e[e.PENDING=0]="PENDING",e[e.ONLINE=1]="ONLINE",e[e.OFFLINE=2]="OFFLINE"}(i||(i={})),function(e){e.USER="user",e.AUTOMATION="automation"}(o||(o={}));class s{constructor(e,t,n){this.timestamp=e,this.state=t,this.changes=n,this.eventType=s.EventType}}s.EventType=e.AnonymousStudentProfileUpdated;class a{constructor(e){this.eventType=a.EventType,this.timestamp=new Date,this.anonymousStudentService=e}}a.EventType=e.AnonymousStudentServiceReady;class c{constructor(e,t,n){this.timestamp=e,this.oldState=t,this.newState=n,this.eventType=c.EventType}}c.EventType=e.AnonymousStudentStateChanged;var u=n(527);function d(e,t,n){const i=n.value;return n.value=function(...e){return t=this,o=function*(){try{return yield i.apply(this,e)}catch(t){throw v&&v.error(t,e),t}},new((n=void 0)||(n=Promise))((function(e,i){function r(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(r,s)}a((o=o.apply(t,[])).next())}));var t,n,o},n}function l(e,t,n){const i=n.value;return n.value=function(...e){try{return i.apply(this,e)}catch(t){throw v&&v.error(t,e),t}},n}const v=n.g&&n.g.rollbar?new n.g.rollbar({accessToken:"ae4171ca3aad492887231362eba50499",captureUncaught:!1,captureUnhandledRejections:!1,payload:{environment:"dev"}}):null;var y=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},h=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};class p{constructor(e){this.studentRepository=e}setStudentData(e,t=o.USER){return f(this,void 0,void 0,(function*(){yield this.studentRepository.setStudentData(e,t)}))}getStudentData(e){return f(this,void 0,void 0,(function*(){return this.studentRepository.getStudentData(e)}))}getStudentDataCompleteness(e){return f(this,void 0,void 0,(function*(){return this.studentRepository.getStudentDataCompleteness(e)}))}addToCollection(e,t){return f(this,void 0,void 0,(function*(){return this.studentRepository.addToCollection(e,t)}))}removeFromCollection(e,t){return f(this,void 0,void 0,(function*(){return this.studentRepository.removeFromCollection(e,t)}))}addDisciplines(e){return f(this,void 0,void 0,(function*(){return this.addToCollection(u.Gq.DISCIPLINES,e)}))}removeDisciplines(e){return f(this,void 0,void 0,(function*(){return this.removeFromCollection(u.Gq.DISCIPLINES,e)}))}addInterest(e,t){return f(this,void 0,void 0,(function*(){return this.addToCollection(e,t)}))}removeInterest(e,t){return f(this,void 0,void 0,(function*(){return this.removeFromCollection(e,t)}))}setName(e){return f(this,void 0,void 0,(function*(){return this.studentRepository.setName(e)}))}setGPA(e,t){return f(this,void 0,void 0,(function*(){return this.studentRepository.setGPA(e,t)}))}}y([d,h("design:type",Function),h("design:paramtypes",[Object,String]),h("design:returntype",Promise)],p.prototype,"setStudentData",null),y([d,h("design:type",Function),h("design:paramtypes",[Array]),h("design:returntype",Promise)],p.prototype,"getStudentData",null),y([d,h("design:type",Function),h("design:paramtypes",[Array]),h("design:returntype",Promise)],p.prototype,"getStudentDataCompleteness",null),y([d,h("design:type",Function),h("design:paramtypes",[String,Array]),h("design:returntype",Promise)],p.prototype,"addToCollection",null),y([d,h("design:type",Function),h("design:paramtypes",[String,Array]),h("design:returntype",Promise)],p.prototype,"removeFromCollection",null),y([d,h("design:type",Function),h("design:paramtypes",[Array]),h("design:returntype",Promise)],p.prototype,"addDisciplines",null),y([d,h("design:type",Function),h("design:paramtypes",[Array]),h("design:returntype",Promise)],p.prototype,"removeDisciplines",null),y([d,h("design:type",Function),h("design:paramtypes",[String,Array]),h("design:returntype",Promise)],p.prototype,"addInterest",null),y([d,h("design:type",Function),h("design:paramtypes",[String,Array]),h("design:returntype",Promise)],p.prototype,"removeInterest",null),y([d,h("design:type",Function),h("design:paramtypes",[String]),h("design:returntype",Promise)],p.prototype,"setName",null),y([d,h("design:type",Function),h("design:paramtypes",[String,Object]),h("design:returntype",Promise)],p.prototype,"setGPA",null);class S{constructor(e){this.eventAggregationService=e}broadcastStudentProfileSyncedEvent(e){this.eventAggregationService.publishTo(r.EventType,e)}broadcastProfileUpdatedEvent(e){this.eventAggregationService.publishTo(s.EventType,e)}broadcastStateChangedEvent(e){this.eventAggregationService.publishTo(c.EventType,e)}}var g=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};class E{constructor(e,t){this.offline=e,this.online=t,this.overwriteProtectionFields=[u.Gq.NATIONALITY_COUNTRY_ISO,u.Gq.NATIONALITY_COUNTRY_ID,u.Gq.CURRENCY]}syncData(){return g(this,void 0,void 0,(function*(){const e=yield this.getOfflineData(),t=yield this.enforceOverrideProtection(e);Object.keys(t).length>0&&(yield this.online.setStudentData(t,o.USER))}))}enforceOverrideProtection(e){return g(this,void 0,void 0,(function*(){const t=Object.keys(e),n=yield this.online.getStudentData(t),i=this.getFieldsThatAreActuallySet(n),r=yield this.offline.getWriteHistory();for(const n of t){if(!this.overwriteProtectionFields.includes(n))continue;if(!i.includes(n))continue;const t=r.find((e=>e.field===n));t&&t.actor===o.AUTOMATION&&delete e[n]}return e}))}getOfflineData(){return g(this,void 0,void 0,(function*(){const e=this.getAllStudentFields(),t=yield this.offline.getStudentData(e),n=this.getFieldsThatAreActuallySet(t);if(0===n.length)return{};const i={};return n.forEach((e=>{i[e]=t[e]})),i}))}getFieldsThatAreActuallySet(e){return Object.keys(e).filter((t=>void 0!==e[t]))}getAllStudentFields(){const e=[];return Object.keys(u.Gq).forEach((t=>{e.push(u.Gq[t])})),e}}var m=n(328),T=n(36),_=n(996),O=n.n(_),b=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};class I{constructor(e,t,n=null){this.storageKey=e,this.storageTTL=t,this.anonymousStudentEventBroadcaster=n,this.localStorage=T.DataStorage,this.storageKeyWriteHistory=`${e}/WriteHistory`}cleanUp(){this.localStorage.remove(this.storageKey),this.localStorage.remove(this.storageKeyWriteHistory)}getData(e){return b(this,void 0,void 0,(function*(){const t=this.retrieveDataFromLocalStorage(),n={};return e.forEach((e=>{const i=t[e];void 0!==i&&(n[e]=null!==i?i:void 0)})),n}))}setData(e){return b(this,void 0,void 0,(function*(){const t=this.retrieveDataFromLocalStorage(),n=O()(t,e,{arrayMerge:this.mergeArraysWithoutDuplicates});Object.keys(n).forEach((e=>{null===n[e]&&(n[e]=void 0)})),this.setDataInLocalStorage(n),this.broadcastChanges(n)}))}mergeArraysWithoutDuplicates(e,t,n){return[...new Set([...e,...t])]}addToCollection(e,t){return b(this,void 0,void 0,(function*(){this.addToIdListInLocalStorage(e,t)}))}removeFromCollection(e,t){return b(this,void 0,void 0,(function*(){this.removeFromIdListInLocalStorage(e,t)}))}addToWriteHistory(e,t){return b(this,void 0,void 0,(function*(){let n=[];const i=this.localStorage.retrieve(this.storageKeyWriteHistory);i&&(n=JSON.parse(i));for(const i of e){const e=n.find((e=>e.field===i));e?e.actor=t:n.push({field:i,actor:t})}this.localStorage.store(this.storageKeyWriteHistory,JSON.stringify(n),this.storageTTL)}))}getWriteHistory(){return b(this,void 0,void 0,(function*(){const e=this.localStorage.retrieve(this.storageKeyWriteHistory);return e?JSON.parse(e):[]}))}retrieveDataFromLocalStorage(){const e=this.localStorage.retrieve(this.storageKey);return e?JSON.parse(e):{}}setDataInLocalStorage(e){Object.keys(e).forEach((t=>{void 0===e[t]&&(e[t]=null)})),this.localStorage.store(this.storageKey,JSON.stringify(e),this.storageTTL)}addToIdListInLocalStorage(e,t){const n=this.retrieveDataFromLocalStorage(),i=new Set(n[e]);t.forEach((e=>{i.add(e)})),n[e]=Array.from(i),this.setDataInLocalStorage(n),this.broadcastChanges({[e]:n[e]})}removeFromIdListInLocalStorage(e,t){const n=this.retrieveDataFromLocalStorage(),i=new Set(n[e]);t.forEach((e=>{i.delete(e)})),n[e]=Array.from(i),this.setDataInLocalStorage(n),this.broadcastChanges({[e]:n[e]})}broadcastChanges(e){if(!this.anonymousStudentEventBroadcaster)return;const t=new s(new Date,i.OFFLINE,e);this.anonymousStudentEventBroadcaster.broadcastProfileUpdatedEvent(t)}}class R{constructor(e,t,n,i){this.stateType=e,this.eventAggregationService=t,this.sessionService=n,this.studentRepository=i}}var D=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},A=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},C=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};class P extends R{constructor(e,t,n){super(i.OFFLINE,e,t,n),this.eventAggregationService=e,this.sessionService=t,this.studentRepository=n,this.anonymousStudentEventBroadcaster=n.anonymousStudentEventBroadcaster,this.studentClient=new I("AnonymousStudent/Offline",2629800,this.anonymousStudentEventBroadcaster)}initialize(){this.eventAggregationService.subscribeTo(m.SessionCreatedEvent.EventType,this)}notify(e){return C(this,void 0,void 0,(function*(){const e=this.studentRepository.onlineState;yield this.syncData(),this.studentRepository.updateState(e);const t=new r(new Date,i.ONLINE);this.anonymousStudentEventBroadcaster.broadcastStudentProfileSyncedEvent(t)}))}setStudentData(e,t){return C(this,void 0,void 0,(function*(){const n=Object.keys(e);yield this.studentClient.addToWriteHistory(n,t),yield this.studentClient.setData(e)}))}getStudentData(e){return C(this,void 0,void 0,(function*(){return this.studentClient.getData(e)}))}addToCollection(e,t){return C(this,void 0,void 0,(function*(){return this.studentClient.addToCollection(e,t)}))}removeFromCollection(e,t){return C(this,void 0,void 0,(function*(){return this.studentClient.removeFromCollection(e,t)}))}syncData(){return C(this,void 0,void 0,(function*(){yield this.studentRepository.offlineToOnlineSynchronizationService.syncData(),yield this.studentClient.cleanUp()}))}getWriteHistory(){return C(this,void 0,void 0,(function*(){return this.studentClient.getWriteHistory()}))}}D([l,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],P.prototype,"initialize",null),D([d,A("design:type",Function),A("design:paramtypes",[m.SessionCreatedEvent]),A("design:returntype",Promise)],P.prototype,"notify",null);var N=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},w=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};class j{constructor(e,t,n,i){this.studentAPIClient=e,this.localStudentClient=t,this.eventAggregationService=n,this.anonymousStudentEventBroadcaster=i,this.eventAggregationService.subscribeTo(m.WebsocketServiceReadyEvent.EventType,this,!0)}notify(e){return w(this,void 0,void 0,(function*(){e.eventType===m.WebsocketServiceReadyEvent.EventType&&this.handleWebsocketServiceReadyEvent(e),"StudentProfileChanged"===e.eventType&&(yield this.handleWebsocketEvent(e))}))}handleWebsocketServiceReadyEvent(e){e.eventAggregationService.subscribeToWebSocketEvent("StudentProfileChanged",this)}handleWebsocketEvent(e){return w(this,void 0,void 0,(function*(){const t=this.transformStudentProfileChangedEventIntoStudentData(e),n=new Date(e.eventTimestamp);yield this.updateDataFromEvent(t);const o=new s(n,i.ONLINE,t);this.anonymousStudentEventBroadcaster.broadcastProfileUpdatedEvent(o)}))}isForceUpdateField(e){return[u.Gq.DISCIPLINES,u.Gq.INTERESTS_COUNTRIES,u.Gq.INTERESTS_DISCIPLINES,u.Gq.TUITION_BUDGET,u.Gq.LIVING_BUDGET,u.Gq.ATTENDANCE].includes(e)}updateDataFromEvent(e){return w(this,void 0,void 0,(function*(){const t=[];Object.keys(e).forEach((n=>{(e[n]instanceof Object||this.isForceUpdateField(n))&&t.push(n)}));const n=yield this.studentAPIClient.getData(t);yield this.localStudentClient.setData(Object.assign(Object.assign({},e),n))}))}transformStudentProfileChangedEventIntoStudentData(e){const t={};return e.updated&&Object.keys(e.updated).forEach((n=>{t[n]=e.updated[n]})),e.deleted&&Object.keys(e.deleted).forEach((e=>{t[e]=void 0})),t}addToCollection(e,t){return w(this,void 0,void 0,(function*(){yield this.studentAPIClient.addToCollection(e,t),yield this.localStudentClient.addToCollection(e,t)}))}removeFromCollection(e,t){return w(this,void 0,void 0,(function*(){yield this.studentAPIClient.removeFromCollection(e,t),yield this.localStudentClient.removeFromCollection(e,t)}))}getData(e){return w(this,void 0,void 0,(function*(){const t=yield this.localStudentClient.getData(e),n=Object.keys(t),i=e.filter((e=>!n.includes(e)));if(i.length>0){const e=yield this.studentAPIClient.getData(i);return yield this.localStudentClient.setData(e),Object.assign(Object.assign({},t),e)}return t}))}setData(e){return w(this,void 0,void 0,(function*(){yield this.studentAPIClient.setData(e),yield this.localStudentClient.setData(e)}))}clearCache(){return this.localStudentClient.cleanUp()}}!function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);r>3&&s&&Object.defineProperty(t,n,s)}([d,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Promise)],j.prototype,"notify",null);var F=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};class L{constructor(e){this.sessionService=e,this.requestMap=new Map}get fetch(){return fetch}getData(e){return F(this,void 0,void 0,(function*(){const t=this.getActiveDataRequestsAndFieldsToRequest(e),n=t.activeDataRequests,i=t.studentFieldsToRequest;return i.length>0&&n.push(this.retrieveStudentFields(i)),this.mergeStudentDataResponses(yield Promise.all(n))}))}patchData(e){return F(this,void 0,void 0,(function*(){yield fetch("https://studentapi.prtl.co/data",{method:"PATCH",headers:{Authorization:yield this.getAccessToken()},body:JSON.stringify(e)})}))}setData(e){return this.patchData(e)}addToCollection(e,t){return F(this,void 0,void 0,(function*(){return this.patchData({[`${e}_add`]:t})}))}removeFromCollection(e,t){return F(this,void 0,void 0,(function*(){return this.patchData({[`${e}_remove`]:t})}))}getActiveDataRequestsAndFieldsToRequest(e){const t=[],n=[];return e.forEach((e=>{const i=this.requestMap.get(e);i?t.push(i):n.push(e)})),{activeDataRequests:t,studentFieldsToRequest:n}}retrieveStudentFields(e){return F(this,void 0,void 0,(function*(){const t=this.requestStudentData(e);e.forEach((e=>{this.requestMap.set(e,t)}));const n=yield t;return e.forEach((e=>{this.requestMap.delete(e)})),n}))}mergeStudentDataResponses(e){let t={};return e.forEach((e=>{t=Object.assign(Object.assign({},t),e)})),t}requestStudentData(e){return F(this,void 0,void 0,(function*(){const t=yield fetch(`https://studentapi.prtl.co/data?scope=${e.join(",")}`,{headers:{Authorization:yield this.getAccessToken()}});if(!t.ok)throw new Error("Failed to retrieve data from StudentAPI");const n=yield t.json();return Object.keys(n).forEach((e=>{null===n[e]&&(n[e]=void 0)})),n}))}getAccessToken(){return F(this,void 0,void 0,(function*(){return(yield this.sessionService.getSession()).getAccessToken()}))}}var M=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},U=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};class k extends R{constructor(e,t,n){super(i.ONLINE,e,t,n),this.eventAggregationService=e,this.sessionService=t,this.studentRepository=n,this.studentClient=null}constructStudentClient(){const e=new S(this.eventAggregationService),t=new I("AnonymousStudent/Online",3600),n=new L(this.sessionService);return new j(n,t,this.eventAggregationService,e)}initialize(){this.studentClient=this.constructStudentClient(),this.eventAggregationService.subscribeTo(m.SessionDestroyedEvent.EventType,this)}notify(e){this.studentClient.clearCache()}setStudentData(e,t){return U(this,void 0,void 0,(function*(){return this.studentClient.setData(e)}))}getStudentData(e){return U(this,void 0,void 0,(function*(){return this.studentClient.getData(e)}))}addToCollection(e,t){return U(this,void 0,void 0,(function*(){return this.studentClient.addToCollection(e,t)}))}removeFromCollection(e,t){return U(this,void 0,void 0,(function*(){return this.studentClient.removeFromCollection(e,t)}))}}!function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);r>3&&s&&Object.defineProperty(t,n,s)}([l,M("design:type",Function),M("design:paramtypes",[]),M("design:returntype",void 0)],k.prototype,"initialize",null);class G{constructor(){this.isOpen=!1,this.isOpeningPromisePresent=!1,this.isReadyCallback=()=>{}}open(){this.isOpen=!0,this.isReadyCallback(),this.reset()}close(){this.isOpen=!1,this.reset()}reset(){this.isReadyCallback=()=>{},this.isOpeningPromisePresent=!1}untilOpen(){return this.isOpeningPromisePresent?this.isOpeningPromisePresent:this.isOpeningPromisePresent=new Promise((e=>{this.isOpen?e(void 0):this.isReadyCallback=e}))}}var x=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},W=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Y=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};class B extends R{constructor(e,t,n){super(i.PENDING,e,t,n),this.lock=new G}initialize(){this.eventAggregationService.subscribeTo(m.SessionServiceReadyEvent.EventType,this,!0)}notify(e){return Y(this,void 0,void 0,(function*(){yield this.onSessionServiceReady(e.sessionService)}))}setStudentData(e,t){return Y(this,void 0,void 0,(function*(){return yield this.lock.untilOpen(),this.state.setStudentData(e,t)}))}getStudentData(e){return Y(this,void 0,void 0,(function*(){return yield this.lock.untilOpen(),this.state.getStudentData(e)}))}addToCollection(e,t){return Y(this,void 0,void 0,(function*(){return yield this.lock.untilOpen(),this.state.addToCollection(e,t)}))}removeFromCollection(e,t){return Y(this,void 0,void 0,(function*(){return yield this.lock.untilOpen(),this.state.removeFromCollection(e,t)}))}onSessionServiceReady(e){return Y(this,void 0,void 0,(function*(){const t=yield e.getSession(),n=this.studentRepository.onlineState,i=this.studentRepository.offlineState;this.state=null===t?i:n,this.studentRepository.updateState(this.state),this.lock.open(),this.state===n&&(yield i.syncData())}))}}x([l,W("design:type",Function),W("design:paramtypes",[]),W("design:returntype",void 0)],B.prototype,"initialize",null),x([d,W("design:type",Function),W("design:paramtypes",[m.SessionServiceReadyEvent]),W("design:returntype",Promise)],B.prototype,"notify",null);var q=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))};const H=window.EventAggregationService,z=new class{constructor(e,t){this.anonymousStudentEventBroadcaster=this.createAnonymousStudentEventBroadcaster(e),this.pendingState=this.createPendingStudentRepositoryState(e,t),this.offlineState=this.createOfflineStudentRepositoryState(e,t),this.onlineState=this.createOnlineStudentRepositoryState(e,t),this.offlineToOnlineSynchronizationService=this.createOfflineToOnlineSynchronizationService(),this.state=this.pendingState}initialize(){this.offlineState.initialize(),this.onlineState.initialize(),this.pendingState.initialize()}setStudentData(e,t){return q(this,void 0,void 0,(function*(){yield this.state.setStudentData(e,t)}))}getStudentData(e){return q(this,void 0,void 0,(function*(){const t=yield this.state.getStudentData(e),n=Object.keys(t);return e.forEach((e=>{n.includes(e)||(t[e]=void 0)})),t}))}getStudentDataCompleteness(e){return q(this,void 0,void 0,(function*(){const t=yield this.getStudentData(e);return e.filter((e=>void 0!==t[e])).length/e.length}))}addToCollection(e,t){return this.state.addToCollection(e,t)}removeFromCollection(e,t){return this.state.removeFromCollection(e,t)}setGPA(e,t){return q(this,void 0,void 0,(function*(){const n={gpa:{[e]:t,current_type:e}};return this.setStudentData(n,o.USER)}))}setName(e){return q(this,void 0,void 0,(function*(){const t=e.indexOf(" ",0);let n,i;-1!==t?(n=e.substring(0,t),i=e.substring(t).trim()):(n=e,i=void 0);const r={name:e,first_name:n,last_name:i};return this.setStudentData(r,o.USER)}))}updateState(e){const t=this.state;this.state=e;const n=new c(new Date,t.stateType,e.stateType);this.anonymousStudentEventBroadcaster.broadcastStateChangedEvent(n)}createPendingStudentRepositoryState(e,t){return new B(e,t,this)}createOnlineStudentRepositoryState(e,t){return new k(e,t,this)}createOfflineStudentRepositoryState(e,t){return new P(e,t,this)}createOfflineToOnlineSynchronizationService(){return new E(this.offlineState,this.onlineState)}createAnonymousStudentEventBroadcaster(e){return new S(e)}}(H,window.SessionService),K=new p(z);window.AnonymousStudent=K,z.initialize();const V=new a(K);H.publishTo(a.EventType,V)})()})();
//# sourceMappingURL=bundle.f09f524dc79a1b6c1149.js.map